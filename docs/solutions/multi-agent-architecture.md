# å¤šæ™ºèƒ½ä½“æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°åŸºäº TradingAgents-CN è®¾è®¡ç†å¿µçš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„,ä¸º cus-ai-agent é¡¹ç›®æä¾›å¤šæ™ºèƒ½ä½“åä½œèƒ½åŠ›ã€‚

### è®¾è®¡ç›®æ ‡

- ğŸ¤– **ä¸“ä¸šåˆ†å·¥**: æ¯ä¸ªæ™ºèƒ½ä½“ä¸“æ³¨äºç‰¹å®šé¢†åŸŸ,æé«˜ä»»åŠ¡å¤„ç†è´¨é‡
- ğŸ”„ **åä½œæœºåˆ¶**: æ™ºèƒ½ä½“ä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’å’ŒçŠ¶æ€å…±äº«è¿›è¡Œåä½œ
- ğŸ“Š **å¯æ‰©å±•æ€§**: æ”¯æŒåŠ¨æ€æ·»åŠ æ–°çš„æ™ºèƒ½ä½“ç±»å‹
- ğŸ¯ **ä»»åŠ¡ç¼–æ’**: ä½¿ç”¨ LangGraph å®ç°å¤æ‚çš„å¤šæ™ºèƒ½ä½“å·¥ä½œæµ
- ğŸ” **å¯è§‚æµ‹æ€§**: å®Œæ•´çš„æ‰§è¡Œè¿½è¸ªå’Œè°ƒè¯•èƒ½åŠ›

### å‚è€ƒæ¶æ„

å‚è€ƒ TradingAgents-CN çš„å¤šæ™ºèƒ½ä½“è®¾è®¡:
- **åˆ†æå¸ˆ(Analyst)**: è´Ÿè´£ä¿¡æ¯åˆ†æå’Œæ´å¯Ÿæå–
- **è§„åˆ’å¸ˆ(Planner)**: è´Ÿè´£ä»»åŠ¡è§„åˆ’å’Œç­–ç•¥åˆ¶å®š
- **æ‰§è¡Œè€…(Executor)**: è´Ÿè´£å…·ä½“ä»»åŠ¡æ‰§è¡Œ
- **è¯„å®¡è€…(Reviewer)**: è´Ÿè´£ç»“æœè¯„å®¡å’Œè´¨é‡æ§åˆ¶
- **åè°ƒè€…(Coordinator)**: è´Ÿè´£æ™ºèƒ½ä½“é—´çš„åè°ƒå’Œè°ƒåº¦

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚"
        A[ç”¨æˆ·è¯·æ±‚]
    end
    
    subgraph "API å±‚"
        B[FastAPI è·¯ç”±]
        C[è¯·æ±‚å¤„ç†å™¨]
    end
    
    subgraph "åè°ƒå±‚"
        D[AgentCoordinator<br/>åè°ƒå™¨]
        E[AgentRegistry<br/>æ³¨å†Œä¸­å¿ƒ]
        F[TaskDispatcher<br/>ä»»åŠ¡åˆ†å‘å™¨]
    end
    
    subgraph "æ™ºèƒ½ä½“å±‚"
        G1[AnalystAgent<br/>åˆ†æå¸ˆ]
        G2[PlannerAgent<br/>è§„åˆ’å¸ˆ]
        G3[ExecutorAgent<br/>æ‰§è¡Œè€…]
        G4[ReviewerAgent<br/>è¯„å®¡è€…]
        G5[ResearchAgent<br/>ç ”ç©¶å‘˜]
    end
    
    subgraph "å·¥å…·å±‚"
        H1[çŸ¥è¯†åº“å·¥å…·]
        H2[API è°ƒç”¨å·¥å…·]
        H3[æ•°æ®åˆ†æå·¥å…·]
        H4[ä»£ç æ‰§è¡Œå·¥å…·]
    end
    
    subgraph "çŠ¶æ€ç®¡ç†"
        I[MultiAgentState<br/>å…±äº«çŠ¶æ€]
        J[InMemorySaver<br/>è®°å¿†å­˜å‚¨]
    end
    
    subgraph "LangGraph ç¼–æ’"
        K[StateGraph<br/>çŠ¶æ€å›¾]
        L[å·¥ä½œæµå¼•æ“]
    end
    
    A --> B
    B --> C
    C --> D
    D --> E
    D --> F
    F --> G1
    F --> G2
    F --> G3
    F --> G4
    F --> G5
    G1 --> H1
    G2 --> H2
    G3 --> H3
    G4 --> H4
    G5 --> H1
    D --> I
    I --> J
    D --> K
    K --> L
    
    style D fill:#FFD700
    style E fill:#87CEEB
    style I fill:#90EE90
```

### åä½œæµç¨‹å›¾

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant C as Coordinator
    participant A as AnalystAgent
    participant P as PlannerAgent
    participant E as ExecutorAgent
    participant R as ReviewerAgent
    
    U->>C: æäº¤å¤æ‚ä»»åŠ¡
    C->>A: åˆ†æä»»åŠ¡éœ€æ±‚
    A->>A: ä¿¡æ¯æ”¶é›†ä¸åˆ†æ
    A->>C: è¿”å›åˆ†æç»“æœ
    
    C->>P: åˆ¶å®šæ‰§è¡Œè®¡åˆ’
    P->>P: ä»»åŠ¡åˆ†è§£ä¸è§„åˆ’
    P->>C: è¿”å›æ‰§è¡Œè®¡åˆ’
    
    C->>E: æ‰§è¡Œå…·ä½“ä»»åŠ¡
    E->>E: è°ƒç”¨å·¥å…·æ‰§è¡Œ
    E->>C: è¿”å›æ‰§è¡Œç»“æœ
    
    C->>R: è¯„å®¡æ‰§è¡Œç»“æœ
    R->>R: è´¨é‡æ£€æŸ¥ä¸éªŒè¯
    R->>C: è¿”å›è¯„å®¡æ„è§
    
    alt è¯„å®¡é€šè¿‡
        C->>U: è¿”å›æœ€ç»ˆç»“æœ
    else è¯„å®¡ä¸é€šè¿‡
        C->>P: é‡æ–°è§„åˆ’
    end
```

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶

### 1. BaseAgent (æ™ºèƒ½ä½“åŸºç±»)

æ‰€æœ‰æ™ºèƒ½ä½“çš„åŸºç±»,å®šä¹‰é€šç”¨æ¥å£å’Œè¡Œä¸ºã€‚

**æ ¸å¿ƒå±æ€§**:
- `agent_id`: æ™ºèƒ½ä½“å”¯ä¸€æ ‡è¯†
- `agent_type`: æ™ºèƒ½ä½“ç±»å‹
- `name`: æ™ºèƒ½ä½“åç§°
- `description`: æ™ºèƒ½ä½“æè¿°
- `capabilities`: æ™ºèƒ½ä½“èƒ½åŠ›åˆ—è¡¨
- `llm`: å¤§è¯­è¨€æ¨¡å‹å®ä¾‹
- `tools`: å¯ç”¨å·¥å…·åˆ—è¡¨

**æ ¸å¿ƒæ–¹æ³•**:
- `process(state)`: å¤„ç†ä»»åŠ¡çš„ä¸»æ–¹æ³•
- `analyze(input)`: åˆ†æè¾“å…¥
- `execute(task)`: æ‰§è¡Œä»»åŠ¡
- `validate(result)`: éªŒè¯ç»“æœ

### 2. AgentRegistry (æ™ºèƒ½ä½“æ³¨å†Œä¸­å¿ƒ)

ç®¡ç†æ‰€æœ‰æ™ºèƒ½ä½“çš„æ³¨å†Œã€å‘ç°å’Œç”Ÿå‘½å‘¨æœŸã€‚

**åŠŸèƒ½**:
- æ™ºèƒ½ä½“æ³¨å†Œä¸æ³¨é”€
- æ™ºèƒ½ä½“æŸ¥è¯¢ä¸å‘ç°
- æ™ºèƒ½ä½“çŠ¶æ€ç®¡ç†
- æ™ºèƒ½ä½“èƒ½åŠ›åŒ¹é…

### 3. AgentCoordinator (åè°ƒå™¨)

è´Ÿè´£å¤šæ™ºèƒ½ä½“é—´çš„åè°ƒã€ä»»åŠ¡åˆ†é…å’Œç»“æœèšåˆã€‚

**åŠŸèƒ½**:
- ä»»åŠ¡åˆ†æä¸åˆ†è§£
- æ™ºèƒ½ä½“é€‰æ‹©ä¸è°ƒåº¦
- æ‰§è¡Œæµç¨‹æ§åˆ¶
- ç»“æœèšåˆä¸ä¼˜åŒ–

### 4. MultiAgentState (å¤šæ™ºèƒ½ä½“çŠ¶æ€)

å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„å…±äº«çŠ¶æ€,ç»§æ‰¿è‡ª AgentStateã€‚

**çŠ¶æ€å­—æ®µ**:
```python
class MultiAgentState(TypedDict):
    # åŸºç¡€å­—æ®µ
    messages: List[BaseMessage]
    session_id: str
    
    # ä»»åŠ¡ç›¸å…³
    task: Dict[str, Any]  # å½“å‰ä»»åŠ¡
    task_plan: List[Dict]  # ä»»åŠ¡è®¡åˆ’
    
    # æ™ºèƒ½ä½“ç›¸å…³
    current_agent: str  # å½“å‰æ‰§è¡Œçš„æ™ºèƒ½ä½“
    agent_results: Dict[str, Any]  # å„æ™ºèƒ½ä½“çš„ç»“æœ
    agent_history: List[Dict]  # æ™ºèƒ½ä½“æ‰§è¡Œå†å²
    
    # åä½œç›¸å…³
    coordination_mode: str  # åä½œæ¨¡å¼: sequential/parallel/hierarchical
    next_agent: Optional[str]  # ä¸‹ä¸€ä¸ªæ™ºèƒ½ä½“
    
    # ç»“æœç›¸å…³
    intermediate_results: List[Dict]  # ä¸­é—´ç»“æœ
    final_result: Optional[Dict]  # æœ€ç»ˆç»“æœ
    
    # å…ƒæ•°æ®
    metadata: Dict[str, Any]
    is_finished: bool
```

---

## ğŸ¤– ä¸“ä¸šæ™ºèƒ½ä½“

### 1. AnalystAgent (åˆ†æå¸ˆ)

**èŒè´£**: ä¿¡æ¯æ”¶é›†ã€æ•°æ®åˆ†æã€æ´å¯Ÿæå–

**èƒ½åŠ›**:
- éœ€æ±‚åˆ†æ
- ä¿¡æ¯æ£€ç´¢
- æ•°æ®åˆ†æ
- è¶‹åŠ¿è¯†åˆ«

**å·¥å…·**:
- çŸ¥è¯†åº“æ£€ç´¢å·¥å…·
- æ•°æ®åˆ†æå·¥å…·
- ç½‘ç»œæœç´¢å·¥å…·

### 2. PlannerAgent (è§„åˆ’å¸ˆ)

**èŒè´£**: ä»»åŠ¡åˆ†è§£ã€ç­–ç•¥åˆ¶å®šã€è®¡åˆ’ä¼˜åŒ–

**èƒ½åŠ›**:
- ä»»åŠ¡åˆ†è§£
- ç­–ç•¥è§„åˆ’
- èµ„æºåˆ†é…
- é£é™©è¯„ä¼°

**å·¥å…·**:
- è§„åˆ’ç®—æ³•å·¥å…·
- ä¼˜åŒ–å·¥å…·

### 3. ExecutorAgent (æ‰§è¡Œè€…)

**èŒè´£**: å…·ä½“ä»»åŠ¡æ‰§è¡Œã€å·¥å…·è°ƒç”¨ã€ç»“æœç”Ÿæˆ

**èƒ½åŠ›**:
- å·¥å…·è°ƒç”¨
- ä»£ç æ‰§è¡Œ
- API è°ƒç”¨
- æ–‡ä»¶æ“ä½œ

**å·¥å…·**:
- æ‰€æœ‰å¯ç”¨å·¥å…·
- ä»£ç æ‰§è¡Œç¯å¢ƒ

### 4. ReviewerAgent (è¯„å®¡è€…)

**èŒè´£**: ç»“æœéªŒè¯ã€è´¨é‡æ£€æŸ¥ã€æ”¹è¿›å»ºè®®

**èƒ½åŠ›**:
- ç»“æœéªŒè¯
- è´¨é‡è¯„ä¼°
- é”™è¯¯æ£€æµ‹
- æ”¹è¿›å»ºè®®

**å·¥å…·**:
- éªŒè¯å·¥å…·
- æµ‹è¯•å·¥å…·

### 5. ResearchAgent (ç ”ç©¶å‘˜)

**èŒè´£**: æ·±åº¦ç ”ç©¶ã€çŸ¥è¯†æ•´åˆã€æŠ¥å‘Šç”Ÿæˆ

**èƒ½åŠ›**:
- æ·±åº¦ç ”ç©¶
- çŸ¥è¯†æ•´åˆ
- æ–‡æ¡£ç”Ÿæˆ
- å¼•ç”¨ç®¡ç†

**å·¥å…·**:
- çŸ¥è¯†åº“å·¥å…·
- æ–‡æ¡£ç”Ÿæˆå·¥å…·

---

## ğŸ”„ åä½œæ¨¡å¼

### 1. é¡ºåºåä½œ (Sequential)

æ™ºèƒ½ä½“æŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œ,å‰ä¸€ä¸ªçš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªçš„è¾“å…¥ã€‚

```mermaid
graph LR
    A[Analyst] --> P[Planner]
    P --> E[Executor]
    E --> R[Reviewer]
```

**é€‚ç”¨åœºæ™¯**: ä»»åŠ¡æœ‰æ˜ç¡®çš„æ‰§è¡Œé¡ºåº,åç»­æ­¥éª¤ä¾èµ–å‰é¢çš„ç»“æœã€‚

### 2. å¹¶è¡Œåä½œ (Parallel)

å¤šä¸ªæ™ºèƒ½ä½“åŒæ—¶æ‰§è¡Œä¸åŒçš„å­ä»»åŠ¡,æœ€åèšåˆç»“æœã€‚

```mermaid
graph TB
    C[Coordinator] --> A1[Agent1]
    C --> A2[Agent2]
    C --> A3[Agent3]
    A1 --> M[Merge]
    A2 --> M
    A3 --> M
```

**é€‚ç”¨åœºæ™¯**: å­ä»»åŠ¡ç›¸äº’ç‹¬ç«‹,å¯ä»¥å¹¶è¡Œå¤„ç†ä»¥æé«˜æ•ˆç‡ã€‚

### 3. å±‚çº§åä½œ (Hierarchical)

åè°ƒè€…åˆ†é…ä»»åŠ¡ç»™ä¸‹çº§æ™ºèƒ½ä½“,ä¸‹çº§æ™ºèƒ½ä½“å¯ä»¥è¿›ä¸€æ­¥åˆ†é…ç»™æ›´ä¸‹çº§ã€‚

```mermaid
graph TB
    C[Coordinator] --> M1[Manager1]
    C --> M2[Manager2]
    M1 --> W1[Worker1]
    M1 --> W2[Worker2]
    M2 --> W3[Worker3]
    M2 --> W4[Worker4]
```

**é€‚ç”¨åœºæ™¯**: å¤æ‚ä»»åŠ¡éœ€è¦å¤šå±‚æ¬¡çš„ç®¡ç†å’Œæ‰§è¡Œã€‚

### 4. åé¦ˆåä½œ (Feedback Loop)

æ™ºèƒ½ä½“ä¹‹é—´å½¢æˆåé¦ˆå¾ªç¯,ä¸æ–­ä¼˜åŒ–ç»“æœã€‚

```mermaid
graph LR
    E[Executor] --> R[Reviewer]
    R -->|é€šè¿‡| O[Output]
    R -->|ä¸é€šè¿‡| P[Planner]
    P --> E
```

**é€‚ç”¨åœºæ™¯**: éœ€è¦è¿­ä»£ä¼˜åŒ–çš„ä»»åŠ¡,å¦‚ä»£ç ç”Ÿæˆã€æ–‡æ¡£æ’°å†™ç­‰ã€‚

---

## ğŸ“Š LangGraph å·¥ä½œæµ

### å¤šæ™ºèƒ½ä½“çŠ¶æ€å›¾

```python
from langgraph.graph import StateGraph, END

# åˆ›å»ºçŠ¶æ€å›¾
workflow = StateGraph(MultiAgentState)

# æ·»åŠ æ™ºèƒ½ä½“èŠ‚ç‚¹
workflow.add_node("coordinator", coordinator_node)
workflow.add_node("analyst", analyst_node)
workflow.add_node("planner", planner_node)
workflow.add_node("executor", executor_node)
workflow.add_node("reviewer", reviewer_node)

# è®¾ç½®å…¥å£
workflow.set_entry_point("coordinator")

# æ·»åŠ æ¡ä»¶è¾¹
workflow.add_conditional_edges(
    "coordinator",
    route_to_agent,
    {
        "analyst": "analyst",
        "planner": "planner",
        "executor": "executor",
        "reviewer": "reviewer",
        "end": END
    }
)

# æ·»åŠ è¿”å›è¾¹
workflow.add_edge("analyst", "coordinator")
workflow.add_edge("planner", "coordinator")
workflow.add_edge("executor", "coordinator")
workflow.add_edge("reviewer", "coordinator")

# ç¼–è¯‘
multi_agent_graph = workflow.compile()
```

---

## ğŸ› ï¸ å®ç°è®¡åˆ’

### é˜¶æ®µ 1: æ ¸å¿ƒæ¡†æ¶ (Week 1)
- [ ] å®ç° BaseAgent åŸºç±»
- [ ] å®ç° AgentRegistry æ³¨å†Œä¸­å¿ƒ
- [ ] å®ç° AgentCoordinator åè°ƒå™¨
- [ ] å®šä¹‰ MultiAgentState çŠ¶æ€

### é˜¶æ®µ 2: ä¸“ä¸šæ™ºèƒ½ä½“ (Week 2)
- [ ] å®ç° AnalystAgent
- [ ] å®ç° PlannerAgent
- [ ] å®ç° ExecutorAgent
- [ ] å®ç° ReviewerAgent
- [ ] å®ç° ResearchAgent

### é˜¶æ®µ 3: åä½œæœºåˆ¶ (Week 3)
- [ ] å®ç°é¡ºåºåä½œæ¨¡å¼
- [ ] å®ç°å¹¶è¡Œåä½œæ¨¡å¼
- [ ] å®ç°å±‚çº§åä½œæ¨¡å¼
- [ ] å®ç°åé¦ˆåä½œæ¨¡å¼

### é˜¶æ®µ 4: LangGraph é›†æˆ (Week 4)
- [ ] åˆ›å»ºå¤šæ™ºèƒ½ä½“çŠ¶æ€å›¾
- [ ] å®ç°è·¯ç”±é€»è¾‘
- [ ] é›†æˆ InMemorySaver
- [ ] æ·»åŠ å¯è§‚æµ‹æ€§

### é˜¶æ®µ 5: API å’Œæ–‡æ¡£ (Week 5)
- [ ] åˆ›å»º REST API æ¥å£
- [ ] ç¼–å†™ä½¿ç”¨æ–‡æ¡£
- [ ] åˆ›å»ºç¤ºä¾‹ä»£ç 
- [ ] ç¼–å†™æµ‹è¯•ç”¨ä¾‹

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: å¤æ‚é—®é¢˜åˆ†æ

```python
# ç”¨æˆ·è¯·æ±‚
request = {
    "task": "åˆ†æå¹¶åˆ¶å®šå¸‚åœºè¥é”€ç­–ç•¥",
    "context": "æ–°äº§å“ä¸Šå¸‚",
    "requirements": ["å¸‚åœºåˆ†æ", "ç«å“åˆ†æ", "ç­–ç•¥å»ºè®®"]
}

# æ‰§è¡Œæµç¨‹
# 1. Coordinator æ¥æ”¶ä»»åŠ¡
# 2. AnalystAgent åˆ†æå¸‚åœºå’Œç«å“
# 3. PlannerAgent åˆ¶å®šè¥é”€ç­–ç•¥
# 4. ReviewerAgent è¯„å®¡ç­–ç•¥
# 5. è¿”å›æœ€ç»ˆç»“æœ
```

### ç¤ºä¾‹ 2: ä»£ç ç”Ÿæˆä¸ä¼˜åŒ–

```python
# ç”¨æˆ·è¯·æ±‚
request = {
    "task": "ç”Ÿæˆå¹¶ä¼˜åŒ– Python å‡½æ•°",
    "requirements": "å®ç°å¿«é€Ÿæ’åºç®—æ³•"
}

# æ‰§è¡Œæµç¨‹
# 1. PlannerAgent åˆ†è§£ä»»åŠ¡
# 2. ExecutorAgent ç”Ÿæˆä»£ç 
# 3. ReviewerAgent æ£€æŸ¥ä»£ç è´¨é‡
# 4. ExecutorAgent æ ¹æ®åé¦ˆä¼˜åŒ–
# 5. å¾ªç¯ç›´åˆ°é€šè¿‡è¯„å®¡
```

---

## ğŸ” ç›‘æ§ä¸è°ƒè¯•

### LangSmith é›†æˆ

æ‰€æœ‰æ™ºèƒ½ä½“æ‰§è¡Œéƒ½ä¼šè¢« LangSmith è¿½è¸ª:
- æ™ºèƒ½ä½“è°ƒç”¨é“¾è·¯
- æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
- å·¥å…·è°ƒç”¨è®°å½•
- é”™è¯¯è¿½è¸ª

### æ—¥å¿—è®°å½•

æ¯ä¸ªæ™ºèƒ½ä½“éƒ½ä¼šè®°å½•è¯¦ç»†æ—¥å¿—:
- ä»»åŠ¡æ¥æ”¶
- å¤„ç†è¿‡ç¨‹
- å·¥å…·è°ƒç”¨
- ç»“æœè¾“å‡º

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. å®ç°æ ¸å¿ƒæ¡†æ¶ä»£ç 
2. åˆ›å»ºä¸“ä¸šæ™ºèƒ½ä½“
3. å®ç°åä½œæœºåˆ¶
4. é›†æˆ LangGraph
5. åˆ›å»º API æ¥å£
6. ç¼–å†™æµ‹è¯•å’Œæ–‡æ¡£

